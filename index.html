<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Social Studio 5.4 - Full Restore</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

  <style>
    :root {
      --primary: #003366;
      --accent: #FFD700;
      --bg-color: #F3F4F6;
      --panel-bg: #FFFFFF;
      --border: #E5E7EB;
      --text-main: #1F2937;
      --text-sec: #6B7280;
      --fb-color: #1877F2;
      --li-color: #0A66C2;
      --ig-gradient: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
      --x-color: #000000;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: "Segoe UI Historic", "Segoe UI", Helvetica, Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-main);
      height: 100vh;
      display: flex;
      overflow: hidden; 
    }

    .app-container { display: flex; width: 100%; height: 100%; }

    /* --- EDITOR SIDEBAR --- */
    .editor-panel {
      width: 450px;
      background: var(--panel-bg);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      height: 100%;
      z-index: 10;
      box-shadow: 4px 0 24px rgba(0,0,0,0.05);
    }

    .editor-header { padding: 20px; border-bottom: 1px solid var(--border); background: white; }
    .brand-title { color: var(--primary); font-weight: 700; font-size: 1.2rem; display: flex; align-items: center; gap: 10px; }
    .brand-dot { width: 10px; height: 10px; background: var(--accent); border-radius: 50%; display: inline-block; }

    .editor-scroll { flex: 1; overflow-y: auto; padding: 20px; }
    .section-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-sec); font-weight: 600; margin: 25px 0 10px 0; border-top: 1px solid #eee; padding-top: 20px; }
    .section-label:first-child { margin-top: 0; border-top: none; padding-top: 0; }

    .input-group { margin-bottom: 20px; }
    .input-group label { display: flex; justify-content: space-between; align-items: center; font-size: 0.9rem; font-weight: 500; margin-bottom: 6px; }
    
    .form-input, .form-textarea {
      width: 100%; padding: 10px 12px; border: 1px solid var(--border); border-radius: 8px;
      font-family: inherit; font-size: 0.95rem;
    }

    .helper-link { font-size: 0.8rem; color: var(--primary); text-decoration: underline; cursor: pointer; margin-top: 5px; display: inline-block; }
    
    .file-drop {
      border: 2px dashed var(--border); border-radius: 8px; padding: 20px; text-align: center;
      cursor: pointer; background: #FAFAFA; position: relative;
    }
    .file-drop input { position: absolute; top:0; left:0; width:100%; height:100%; opacity:0; cursor:pointer; }
    .file-preview-mini { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; margin: 0 auto 5px auto; display: block; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

    .news-selector { display: flex; gap: 5px; background: #f1f1f1; padding: 4px; border-radius: 8px; margin-bottom: 20px; }
    .news-tab { flex: 1; border: none; background: transparent; padding: 8px; font-size: 0.9rem; font-weight: 600; color: var(--text-sec); border-radius: 6px; cursor: pointer; }
    .news-tab.active { background: white; color: var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

    .btn { padding: 12px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; font-size: 0.9rem; transition: transform 0.1s; flex: 1; text-align: center;}
    .btn-primary { background: var(--primary); color: white; }
    .btn-secondary { background: white; border: 1px solid var(--border); color: var(--text-main); }
    .btn-success { background: #10B981; color: white; }
    .btn-full { width: 100%; margin-top: 10px; }

    /* --- PREVIEW PANEL --- */
    .preview-panel {
      flex: 1; background-color: var(--bg-color);
      display: flex; flex-direction: column; align-items: center; padding: 40px; overflow-y: auto;
    }

    .platform-tabs { display: flex; gap: 10px; margin-bottom: 30px; }
    .platform-btn {
      background: white; border: 1px solid var(--border); padding: 10px 20px; border-radius: 50px;
      font-weight: 600; color: var(--text-sec); cursor: pointer; transition: all 0.2s;
    }
    .platform-btn.active { color: white; border-color: transparent; transform: translateY(-2px); }
    .platform-btn.fb.active { background: var(--fb-color); }
    .platform-btn.li.active { background: var(--li-color); }
    .platform-btn.ig.active { background: var(--ig-gradient); }
    .platform-btn.x.active { background: var(--x-color); }

    .mockup-wrapper { width: 500px; max-width: 100%; perspective: 1000px; }
    
    .social-card {
      background: white; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      overflow: hidden; display: none; border: 1px solid rgba(0,0,0,0.05);
    }
    .social-card.active { display: block; }

    /* --- COLLAB & BADGE STYLES (NEW) --- */
    .sc-avatar-container { position: relative; width: 40px; height: 40px; flex-shrink: 0; }
    .sc-avatar { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 1px solid rgba(0,0,0,0.1); }
    .avatar-collab-1 { width: 28px; height: 28px; border-radius: 50%; position: absolute; top: 0; left: 0; z-index: 2; border: 2px solid white; object-fit: cover; display: none; }
    .avatar-collab-2 { width: 28px; height: 28px; border-radius: 50%; position: absolute; bottom: 0; right: 0; z-index: 1; border: 2px solid white; object-fit: cover; display: none; }
    .is-collab .sc-avatar { display: none; }
    .is-collab .avatar-collab-1, .is-collab .avatar-collab-2 { display: block; }
    
    .sc-icon-verified { width: 15px; height: 15px; display: none; }
    .verified-active { display: inline-block; }
    .conjunction { font-weight: 400; color: #65676B; }

    /* RICHIESTA 3: Mappamondo FB */
    .fb-world-icon { width: 12px; height: 12px; filter: grayscale(1); opacity: 0.6; }

    /* --- CARD INTERNALS --- */
    .sc-header { padding: 12px 16px; display: flex; align-items: flex-start; gap: 10px; }
    .sc-info { flex: 1; display: flex; flex-direction: column; justify-content: center; }
    .sc-name { font-weight: 700; font-size: 0.95rem; color: #000000; display: flex; align-items: center; gap: 4px; flex-wrap: wrap; }
    .sc-meta { font-size: 0.8rem; color: #65676B; display: flex; align-items: center; gap: 4px; margin-top: 2px; }
    .sc-text { padding: 0 16px 12px 16px; white-space: pre-wrap; font-size: 15px; line-height: 1.3333; color: #050505; }
    .sc-image-container { width: 100%; background: #f0f2f5; display: flex; align-items: center; justify-content: center; overflow: hidden; }
    .sc-image { width: 100%; height: auto; display: block; }
    
    /* RICHIESTA 5: Icone Interazione (Simili a immagine allegata) */
    .sc-footer { padding: 8px 16px; border-top: 1px solid #eee; }
    .sc-actions { display: flex; justify-content: space-around; align-items: center; color: #65676B; font-weight: 600; font-size: 0.9rem; }
    .action-item { display: flex; align-items: center; gap: 8px; padding: 10px; cursor: pointer; }
    .action-icon { width: 22px; height: 22px; fill: none; stroke: currentColor; stroke-width: 1.8; stroke-linecap: round; stroke-linejoin: round; }

    /* Instagram Specific */
    .card-instagram .sc-avatar-container { width: 32px; height: 32px; }
    .card-instagram .avatar-collab-1, .card-instagram .avatar-collab-2 { width: 22px; height: 22px; }
  </style>
</head>
<body>

  <div class="app-container">
    <aside class="editor-panel">
      <div class="editor-header">
        <div class="brand-title"><span class="brand-dot"></span> Social Studio 5.4</div>
      </div>

      <div class="editor-scroll">
        <div class="section-label">Identità Pagina (Globale)</div>
        <div class="input-group">
          <label>Logo / Avatar Principale</label>
          <input type="file" id="global-avatar" accept="image/*" class="form-input">
        </div>
        <div class="input-group">
          <input type="text" id="global-name" class="form-input" placeholder="Nome Pagina" value="Poste Italiane">
        </div>
        <div class="input-group">
          <input type="text" id="global-handle" class="form-input" placeholder="@handle" value="@posteitaliane">
        </div>
        <label style="display:flex; align-items:center; gap:8px; font-size:0.9rem; cursor:pointer">
          <input type="checkbox" id="main-verified" checked> Badge Verificato Principale
        </label>

        <div class="section-label" style="color: var(--fb-color)">Collaborazione (FB/IG)</div>
        <label style="display:flex; align-items:center; gap:8px; font-size:0.9rem; cursor:pointer; margin-bottom:15px">
          <input type="checkbox" id="collab-active"> Attiva Collaborazione
        </label>
        <div id="collab-fields" style="display:none; background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #ddd;">
            <div class="input-group"><input type="file" id="collab-avatar" accept="image/*" class="form-input"></div>
            <div class="input-group"><input type="text" id="collab-name" class="form-input" placeholder="Nome Partner" value="Partner"></div>
            <div class="input-group"><input type="text" id="collab-handle" class="form-input" placeholder="@partner" value="@partner"></div>
            <label style="display:flex; align-items:center; gap:8px; font-size:0.9rem; cursor:pointer">
              <input type="checkbox" id="collab-verified" checked> Badge Verificato Partner
            </label>
        </div>

        <div class="section-label">Contenuto Post</div>
        <div class="news-selector" id="news-tabs"></div>
        <div style="background: #eef2ff; padding: 10px; border-radius: 8px; margin-bottom: 15px; font-size: 0.8rem; font-weight: 600; color: var(--primary);">
            Stai modificando: <span id="editor-platform-label">Facebook</span>
        </div>

        <div class="input-group">
          <textarea class="form-textarea" id="post-text" rows="5" placeholder="Scrivi il post..."></textarea>
          <span class="helper-link" onclick="app.copyTextToAll()">Copia testo su tutti i canali</span>
        </div>
        <div class="input-group">
          <input type="file" id="post-image" accept="image/*" class="form-input">
          <span class="helper-link" onclick="app.copyImageToAll()">Usa immagine su tutti i canali</span>
        </div>

        <div class="section-label">Progetto</div>
        <div style="display:flex; gap:10px">
          <button class="btn btn-secondary" onclick="app.exportJSON()">Salva JSON</button>
          <button class="btn btn-secondary" onclick="app.triggerImport()">Carica JSON</button>
        </div>
        <input type="file" id="json-input" style="display:none" onchange="app.importJSON(this)">
      </div>

      <div class="editor-footer" style="padding:20px; border-top:1px solid #eee;">
        <button class="btn btn-primary btn-full" onclick="app.downloadZip()">Scarica ZIP Mockups</button>
      </div>
    </aside>

    <main class="preview-panel">
      <div class="platform-tabs">
        <button class="platform-btn fb active" onclick="app.setPlatform('facebook')">Facebook</button>
        <button class="platform-btn li" onclick="app.setPlatform('linkedin')">LinkedIn</button>
        <button class="platform-btn x" onclick="app.setPlatform('x')">X</button>
        <button class="platform-btn ig" onclick="app.setPlatform('instagram')">Instagram</button>
      </div>

      <div class="mockup-wrapper">
        <div id="card-facebook" class="social-card active">
          <div class="sc-header">
            <div class="sc-avatar-container">
                <img src="" class="sc-avatar main-avatar-img">
                <img src="" class="avatar-collab-1 main-avatar-img">
                <img src="" class="avatar-collab-2 partner-avatar-img">
            </div>
            <div class="sc-info">
                <div class="sc-name">
                    <span class="n1">Page</span><svg class="sc-icon-verified main-v" viewBox="0 0 24 24"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm-1.9 14.7L6 12.6l1.4-1.4 2.7 2.7 5.9-5.9 1.4 1.4-7.3 7.3z" fill="#1877F2"/></svg>
                    <span class="conj"></span><span class="n2"></span><svg class="sc-icon-verified partner-v" viewBox="0 0 24 24"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm-1.9 14.7L6 12.6l1.4-1.4 2.7 2.7 5.9-5.9 1.4 1.4-7.3 7.3z" fill="#1877F2"/></svg>
                </div>
                <div class="sc-meta">1 h · <svg class="fb-world-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg></div>
            </div>
          </div>
          <div class="sc-text news-text">...</div>
          <div class="sc-image-container"><img src="" class="sc-image news-image"></div>
          <div class="sc-footer"><div class="sc-actions">
            <div class="action-item"><svg class="action-icon" viewBox="0 0 24 24"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/></svg>Mi piace</div>
            <div class="action-item"><svg class="action-icon" viewBox="0 0 24 24"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>Commenta</div>
            <div class="action-item"><svg class="action-icon" viewBox="0 0 24 24"><path d="M15 8v-5l9 9-9 9v-5c-10 0-14 5-14 5s2-13 14-13z"/></svg>Condividi</div>
          </div></div>
        </div>

        <div id="card-instagram" class="social-card">
            <div class="sc-header">
              <div class="sc-avatar-container">
                  <img src="" class="sc-avatar main-avatar-img">
                  <img src="" class="avatar-collab-1 main-avatar-img">
                  <img src="" class="avatar-collab-2 partner-avatar-img">
              </div>
              <div class="sc-info">
                  <div class="sc-name">
                      <span class="n1">@handle</span><svg class="sc-icon-verified main-v" viewBox="0 0 24 24"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm-1.9 14.7L6 12.6l1.4-1.4 2.7 2.7 5.9-5.9 1.4 1.4-7.3 7.3z" fill="#0095f6"/></svg>
                      <span class="conj"></span><span class="n2"></span><svg class="sc-icon-verified partner-v" viewBox="0 0 24 24"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm-1.9 14.7L6 12.6l1.4-1.4 2.7 2.7 5.9-5.9 1.4 1.4-7.3 7.3z" fill="#0095f6"/></svg>
                  </div>
              </div>
            </div>
            <div class="sc-image-container"><img src="" class="sc-image news-image"></div>
            <div class="sc-text news-text">...</div>
        </div>

        <div id="card-linkedin" class="social-card">
            <div class="sc-header"><div class="sc-avatar-container"><img src="" class="sc-avatar main-avatar-img"></div><div class="sc-info"><div class="sc-name"><span class="n1">Page</span><svg class="sc-icon-verified main-v" viewBox="0 0 24 24"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm-1.9 14.7L6 12.6l1.4-1.4 2.7 2.7 5.9-5.9 1.4 1.4-7.3 7.3z" fill="#0A66C2"/></svg></div><div class="sc-meta">Azienda • 2h</div></div></div>
            <div class="sc-text news-text"></div><div class="sc-image-container"><img src="" class="sc-image news-image"></div>
        </div>
        <div id="card-x" class="social-card">
            <div class="sc-header"><div class="sc-avatar-container"><img src="" class="sc-avatar main-avatar-img"></div><div class="sc-info"><div class="sc-name"><span class="n1">@handle</span><svg class="sc-icon-verified main-v" viewBox="0 0 24 24"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm-1.9 14.7L6 12.6l1.4-1.4 2.7 2.7 5.9-5.9 1.4 1.4-7.3 7.3z" fill="#000"/></svg></div><div class="sc-meta">19 min</div></div></div>
            <div class="sc-text news-text"></div><div class="sc-image-container"><img src="" class="sc-image news-image"></div>
        </div>
      </div>
    </main>
  </div>

  <script>
    const app = {
      state: {
        activeNews: 1,
        activePlatform: 'facebook',
        global: {
            name: 'Poste Italiane', handle: '@posteitaliane', avatar: null, isVerified: true,
            collabActive: false, collabName: 'Partner', collabHandle: '@partner', collabAvatar: null, collabVerified: true
        },
        news: {} // Struttura originale preservata: { nid: { pid: { text: '', img: '' } } }
      },

      init() {
        this.loadState();
        this.renderTabs();
        this.bindEvents();
        this.updateUI();
      },

      renderTabs() {
        const container = document.getElementById('news-tabs');
        container.innerHTML = '';
        for(let i=1; i<=5; i++) {
          const btn = document.createElement('button');
          btn.className = `news-tab ${i===this.state.activeNews ? 'active' : ''}`;
          btn.innerText = `News ${i}`;
          btn.onclick = () => this.switchNews(i);
          container.appendChild(btn);
        }
      },

      bindEvents() {
        const listen = (id, key, sub = 'global', isCheck = false) => {
            document.getElementById(id).addEventListener(isCheck ? 'change' : 'input', (e) => {
                this.state[sub][key] = isCheck ? e.target.checked : e.target.value;
                if(id === 'collab-active') document.getElementById('collab-fields').style.display = e.target.checked ? 'block' : 'none';
                this.updateUI(); this.saveState();
            });
        };

        listen('global-name', 'name'); listen('global-handle', 'handle');
        listen('main-verified', 'isVerified', 'global', true);
        listen('collab-active', 'collabActive', 'global', true);
        listen('collab-name', 'collabName'); listen('collab-handle', 'collabHandle');
        listen('collab-verified', 'collabVerified', 'global', true);

        document.getElementById('post-text').addEventListener('input', (e) => {
          this.getCurrentData().text = e.target.value;
          this.updatePreviewContent(); this.saveState();
        });

        document.getElementById('global-avatar').onchange = (e) => this.handleFile(e.target.files[0], 'avatar');
        document.getElementById('collab-avatar').onchange = (e) => this.handleFile(e.target.files[0], 'collabAvatar');
        document.getElementById('post-image').onchange = (e) => this.handleFile(e.target.files[0], 'postImage');
      },

      handleFile(file, type) {
        if(!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            if(type === 'avatar') this.state.global.avatar = e.target.result;
            else if(type === 'collabAvatar') this.state.global.collabAvatar = e.target.result;
            else this.getCurrentData().img = e.target.result;
            this.updateUI(); this.saveState();
        };
        reader.readAsDataURL(file);
      },

      getCurrentData() {
        const nid = this.state.activeNews, pid = this.state.activePlatform;
        if(!this.state.news[nid]) this.state.news[nid] = {};
        if(!this.state.news[nid][pid]) this.state.news[nid][pid] = { text: '', img: null };
        return this.state.news[nid][pid];
      },

      updateUI() {
        const g = this.state.global;
        document.getElementById('editor-platform-label').innerText = this.state.activePlatform.charAt(0).toUpperCase() + this.state.activePlatform.slice(1);
        
        document.querySelectorAll('.social-card').forEach(card => {
            const isCollab = g.collabActive && (card.id === 'card-facebook' || card.id === 'card-instagram');
            card.querySelector('.sc-avatar-container').classList.toggle('is-collab', isCollab);
            
            const n1 = card.querySelector('.n1'), n2 = card.querySelector('.n2'), conj = card.querySelector('.conj');
            n1.innerText = (card.id === 'card-instagram' || card.id === 'card-x') ? g.handle : g.name;

            if(isCollab && n2) {
                conj.innerHTML = `<span class="conjunction">${card.id === 'card-facebook' ? ' con ' : ', '}</span>`;
                n2.innerText = card.id === 'card-facebook' ? g.collabName : g.collabHandle;
                card.querySelector('.partner-v').classList.toggle('verified-active', g.collabVerified);
            } else if(n2) {
                conj.innerText = ''; n2.innerText = '';
                card.querySelector('.partner-v').classList.remove('verified-active');
            }
            card.querySelector('.main-v').classList.toggle('verified-active', g.isVerified);
        });

        document.querySelectorAll('.main-avatar-img').forEach(img => img.src = g.avatar || 'https://via.placeholder.com/40');
        document.querySelectorAll('.partner-avatar-img').forEach(img => img.src = g.collabAvatar || 'https://via.placeholder.com/40');
        
        document.getElementById('post-text').value = this.getCurrentData().text || '';
        this.updatePreviewContent();
      },

      updatePreviewContent() {
        // Ripristinata logica originale: aggiorna solo la card del canale selezionato o tutte se caricate
        Object.keys(this.state.news[this.state.activeNews] || {}).forEach(pid => {
            const card = document.getElementById(`card-${pid}`);
            if(card) {
                const data = this.state.news[this.state.activeNews][pid];
                card.querySelector('.news-text').innerText = data.text || '';
                const img = card.querySelector('.news-image');
                img.src = data.img || '';
                img.style.display = data.img ? 'block' : 'none';
            }
        });
      },

      switchNews(id) { this.state.activeNews = id; this.renderTabs(); this.updateUI(); },
      setPlatform(p) {
        this.state.activePlatform = p;
        document.querySelectorAll('.platform-btn').forEach(b => b.classList.toggle('active', b.classList.contains(p.slice(0,2))));
        document.querySelectorAll('.social-card').forEach(c => c.classList.toggle('active', c.id === `card-${p}`));
        this.updateUI();
      },

      copyTextToAll() {
        const txt = this.getCurrentData().text;
        ['facebook','linkedin','x','instagram'].forEach(p => this.state.news[this.state.activeNews][p].text = txt);
        this.updatePreviewContent(); alert("Testo copiato!");
      },

      copyImageToAll() {
        const img = this.getCurrentData().img;
        ['facebook','linkedin','x','instagram'].forEach(p => this.state.news[this.state.activeNews][p].img = img);
        this.updatePreviewContent(); alert("Immagine copiata!");
      },

      saveState() { localStorage.setItem('socialStudio_v5_4', JSON.stringify(this.state)); },
      loadState() { const saved = localStorage.getItem('socialStudio_v5_4'); if(saved) this.state = JSON.parse(saved); },
      exportJSON() { saveAs(new Blob([JSON.stringify(this.state, null, 2)], {type:"application/json"}), "progetto.json"); },
      triggerImport() { document.getElementById('json-input').click(); },
      importJSON(input) { 
        const reader = new FileReader();
        reader.onload = (e) => { this.state = JSON.parse(e.target.result); this.updateUI(); };
        reader.readAsText(input.files[0]);
      },

      async downloadZip() {
        const zip = new JSZip();
        for(const p of ['facebook','linkedin','x','instagram']) {
            this.setPlatform(p); await new Promise(r => setTimeout(r, 100));
            const canvas = await html2canvas(document.getElementById(`card-${p}`), {scale:2});
            const blob = await new Promise(r => canvas.toBlob(r));
            zip.file(`${p}.png`, blob);
        }
        zip.generateAsync({type:"blob"}).then(c => saveAs(c, "mockups.zip"));
      }
    };

    window.onload = () => app.init();
  </script>
</body>
</html>
